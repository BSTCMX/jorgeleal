---
interface Props {
  id: string;
  defaultText: string;
  filePathEs: string;
  filePathEn: string;
  i18nKey: string;
  analyticsAction: string;
  icon?: 'document' | 'resume';
}

const { id, defaultText, filePathEs, filePathEn, i18nKey, analyticsAction, icon = 'document' } = Astro.props;

const documentIcon = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />`;

const resumeIcon = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />`;

const iconPath = icon === 'resume' ? resumeIcon : documentIcon;
---

<button 
  id={id}
  data-file-es={filePathEs}
  data-file-en={filePathEn}
  data-analytics-action={analyticsAction}
  class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105"
>
  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" set:html={iconPath}></svg>
  <span data-i18n={i18nKey}>{defaultText}</span>
</button>

<script>
  import { trackEvent } from '../lib/analytics';
  
  function setupDownloadButton(buttonId: string) {
    const btn = document.getElementById(buttonId);
    if (!btn) return;
    
    const fileEs = btn.getAttribute('data-file-es');
    const fileEn = btn.getAttribute('data-file-en');
    const analyticsAction = btn.getAttribute('data-analytics-action');
    
    if (!fileEs || !fileEn || !analyticsAction) {
      console.error(`DownloadButton: Missing required data attributes for button ${buttonId}`);
      return;
    }
    
    btn.addEventListener('click', () => {
      const lang = (window as any).currentLang || 'es';
      const file = lang === 'es' ? fileEs : fileEn;
      
      trackEvent({
        event_type: 'click',
        event_props: {
          action: analyticsAction,
          language: lang
        }
      });
      
      const link = document.createElement('a');
      link.href = file;
      link.download = file.split('/').pop() || 'download.pdf';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('button[data-file-es][data-file-en]');
    buttons.forEach(btn => {
      if (btn.id) {
        setupDownloadButton(btn.id);
      }
    });
  });
</script>
